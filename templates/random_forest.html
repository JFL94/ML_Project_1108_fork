{% extends "base.html" %}

{% block title %}隨機森林 - 離職預測{% endblock %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/prediction.css') }}">
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>隨機森林 Random Forest</h1>
    <!-- G-02: 更新頁面說明 -->
    <p>請在下方表單中輸入員工資料，系統將預測其離職傾向並將結果新增至報告中。</p>
</div>

<!-- G-02: 將滑桿區塊替換為新的表單和報告表格 -->
<div class="interactive-prediction-wrapper">

    <!-- 輸入表單 -->
    <div class="card-style" id="prediction-form-card">
        <h2 class="panel-title">新預測資料輸入</h2>
        <!-- 使用 <form> 元素以利於事件處理 -->
        <form id="prediction-form" class="prediction-form-grid">

            <div class="form-group">
                <label for="employee_id">員工ID</label>
                <!-- 設置為 required -->
                <input type="text" id="employee_id" name="employee_id" placeholder="例如: A001" required>
            </div>

            <div class="form-group">
                <label for="feature1">工作負荷量滿意度 (1=滿意, 5=不滿意)</label>
                <!-- 設置為 required 並有預設提示 -->
                <select id="feature1" name="feature1" required>
                    <option value="" disabled selected>請選擇...</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>

            <div class="form-group">
                <label for="feature2">申訴管道滿意度 (1=滿意, 5=不滿意)</label>
                <!-- 設置為 required 並有預設提示 -->
                <select id="feature2" name="feature2" required>
                    <option value="" disabled selected>請選擇...</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                    <option value="3">3</option>
                    <option value="4">4</option>
                    <option value="5">5</option>
                </select>
            </div>

            <div class="form-buttons">
                <button type="submit" class="btn-primary">送出預測</button>
                <!-- 重新輸入按鈕 -->
                <button type="button" id="reset-form-btn" class="btn-secondary">重新輸入</button>
            </div>
        </form>
        <!-- 用於顯示成功或錯誤訊息 -->
        <div id="form-message" class="form-message" role="alert"></div>
    </div>

    <!-- 預測報告表格 -->
    <div class="card-style" id="prediction-report-card">
        <h2 class="panel-title">預測報告</h2>
        <div class="prediction-report-container">
            <table class="prediction-report-table">
                <thead>
                    <tr>
                        <th>員工ID</th>
                        <th>工作負荷 (x1)</th>
                        <th>申訴管道 (x5)</th>
                        <th>預測結果 (0=無, 1=有)</th>
                    </tr>
                </thead>
                <tbody id="report-table-body">
                    <!-- JavaScript 將會在此插入預測結果 -->
                </tbody>
            </table>
        </div>
    </div>
</div>
<!-- 新區塊結束 -->


<div class="chart-container card-style">
    <h2>特徵分佈散佈圖 (200筆隨機樣本)</h2>
    <div class="chart-controls">
        <button id="chart-filter-all" class="chart-filter-btn active">全部顯示</button>
        <button id="chart-filter-no" class="chart-filter-btn">無離職傾向</button>
        <button id="chart-filter-yes" class="chart-filter-btn">有離職傾向</button>
    </div>
    <div class="chart-canvas-wrapper">
        <canvas id="scatterChart"></canvas>
    </div>
    <div class="chart-legend">
        <span class="legend-item legend-no">■ 無離職傾向</span>
        <span class="legend-item legend-yes">■ 有離職傾向</span>
    </div>
</div>

<div class="info-blocks-wrapper">
    <div class="info-card card-style">
        <h3>模型評估指標</h3>

        <div class="info-grid" id="model-evaluation-list">

            <div class="info-item">
                <span class="info-item-label">召回率</span>
                <span class="info-item-value" id="metric-recall">載入中...</span>
            </div>

            <div class="info-item">
                <span class="info-item-label">F1-Score</span>
                <span class="info-item-value" id="metric-f1">載入中...</span>
            </div>

            <div class="info-item">
                <span class="info-item-label">AUC 分數</span>
                <span class="info-item-value" id="metric-auc">載入中...</span>
            </div>

        </div>
    </div>

    <div class="info-card card-style">
        <h3>模型資訊</h3>

        <div class="info-grid" id="model-info-list">

            <div class="info-item">
                <span class="info-item-label">資料集</span>
                <span class="info-item-value" id="info-dataset-name">載入中...</span>
            </div>

            <div class="info-item">
                <span class="info-item-label">總樣本數</span>
                <span class="info-item-value" id="info-total-samples">載入中...</span>
            </div>

            <div class="info-item">
                <span class="info-item-label">訓練集大小</span>
                <span class="info-item-value" id="info-train-size">載入中...</span>
            </div>

            <div class="info-item">
                <span class="info-item-label">測試集大小</span>
                <span class="info-item-value" id="info-test-size">載入中...</span>
            </div>

            <div class="info-item">
                <span class="info-item-label">預測目標</span>
                <span class="info-item-value" id="info-target">載入中...</span>
            </div>

        </div>
    </div>

    <div class="info-card card-style">
        <h3 id="chart-info-title">圖表說明</h3>
        <p id="chart-info-description">載入中...</p>
    </div>
</div>


</div>

{% endblock %}

{% block code %}
<script src="{{ url_for('static', filename='vendor/chart.js/chart.umd.js') }}"></script>
<!-- G-02: 確保載入的是 random_forest.js -->
<script src="{{ url_for('static', filename='js/random_forest.js') }}"></script>
{% endblock%}